<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>GeoGebra</title>
  <script src="https://www.geogebra.org/apps/deployggb.js"></script>
</head>
<body>
  <div id="ggb-element" style="width: 100%; height: 100%;"></div>
  <script>
    let isGgbReady = false;

    function ggbOnInit() {
      console.log("[GeoGebra] Апплет инициализирован.");
      isGgbReady = true;
    }

    function setFunctionExpression(funcStr) {
      console.log("[JS] setFunctionExpression вызван с:", funcStr);
      const commands = [
        'Delete["f"]',
        'Delete["Roots"]',
        `f(x) = ${funcStr}`,
        'Roots = Root[f]',
        'SetVisibleInView[f,1,true]',
        'SetVisibleInView[Roots,1,true]',
        'ShowAxes = true',
        'ZoomStandard[]'
      ];

      const executeCommands = () => {
        try {
          commands.forEach(cmd => {
            if (typeof ggbApplet !== 'undefined' && ggbApplet.evalCommand) {
              ggbApplet.evalCommand(cmd);
            }
          });
          console.log("[JS] Команды выполнены.");
        } catch (e) {
          console.error("[JS] Ошибка выполнения команд:", e);
        }
      };

      if (isGgbReady && typeof ggbApplet !== 'undefined') {
        executeCommands();
      } else {
        console.warn("[JS] Ожидание готовности GeoGebra...");
        const timer = setInterval(() => {
          if (isGgbReady && typeof ggbApplet !== 'undefined') {
            clearInterval(timer);
            executeCommands();
          }
        }, 300);
      }
    }

    var ggbApp = new GGBApplet({
      "appName": "graphing",
      "width": "100%",
      "height": "100%",
      "showToolBar": false,
      "showAlgebraInput": false,
      "showMenuBar": false,
      "enableLabelDrags": false,
      "enableShiftDragZoom": true,
      "enableRightClick": false,
      "language": "ru",
      "onLoad": "ggbOnInit"
    }, true);
    ggbApp.inject('ggb-element');
  </script>
</body>
</html>